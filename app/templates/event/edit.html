{% extends "base.html" %}
{% block title %}Etkinlik DÃ¼zenle{% endblock %}

{% block content %}
<div class="mx-auto max-w-5xl space-y-6">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div class="space-y-1">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400 dark:text-slate-600">DÃ¼zenle</p>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Etkinlik DÃ¼zenle</h1>
            <p class="text-sm text-slate-600 dark:text-slate-400">Etkinlik bilgilerini gÃ¼ncelle ve koltuk dÃ¼zenini
                yeniden planla.</p>
        </div>
        <div class="flex flex-wrap items-center gap-2">
            <a href="{{ url_for('event.index') }}" class="btn-shadcn btn-shadcn-ghost btn-shadcn-sm">
                <i class="fas fa-arrow-left"></i>
                <span>Geri DÃ¶n</span>
            </a>
            <a href="{{ url_for('template.seating_templates') }}" class="btn-shadcn btn-shadcn-outline btn-shadcn-sm">
                <i class="fas fa-layer-group"></i>
                <span>Åžablonlar</span>
            </a>
        </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <form method="POST" action="{{ url_for('event.edit', event_id=event.id) }}" class="space-y-6">
            <!-- Temel Bilgiler -->
            <section class="card-shadcn">
                <div class="card-shadcn-header pb-4">
                    <div class="flex items-center gap-3">
                        <span
                            class="inline-flex h-11 w-11 items-center justify-center rounded-xl bg-primary/10 text-primary">
                            <i class="fas fa-calendar-edit"></i>
                        </span>
                        <div>
                            <h2 class="card-shadcn-title text-xl">Temel Bilgiler</h2>
                            <p class="card-shadcn-description">EtkinliÄŸin adÄ±, tarihi, tÃ¼rÃ¼ ve mekan bilgilerini
                                gÃ¼ncelle.</p>
                        </div>
                    </div>
                </div>
                <div class="card-shadcn-content">
                    <div class="grid gap-5 md:grid-cols-2">
                        <label class="md:col-span-2 space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-signature text-primary"></i>
                                Etkinlik AdÄ±
                            </span>
                            <input type="text" class="input-shadcn" name="name" value="{{ event.name or '' }}"
                                placeholder="Ã–rn: 2025 Lansman Gecesi" autocomplete="off" required>
                        </label>

                        <label class="md:col-span-2 space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-align-left text-primary"></i>
                                AÃ§Ä±klama
                            </span>
                            <textarea class="input-shadcn min-h-[100px] resize-none" name="description"
                                placeholder="Etkinlik hakkÄ±nda detaylÄ± bilgi...">{{ event.description or '' }}</textarea>
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="far fa-calendar text-primary"></i>
                                Etkinlik Tarihi
                            </span>
                            <input type="date" class="input-shadcn" name="event_date"
                                value="{{ event.event_date.strftime('%Y-%m-%d') if event.event_date else '' }}"
                                autocomplete="off" required>
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="far fa-clock text-primary"></i>
                                BaÅŸlangÄ±Ã§ Saati
                            </span>
                            <input type="time" class="input-shadcn" name="start_time"
                                value="{{ event.start_time.strftime('%H:%M') if event.start_time else '' }}"
                                autocomplete="off">
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="far fa-clock text-primary"></i>
                                BitiÅŸ Saati
                            </span>
                            <input type="time" class="input-shadcn" name="end_time"
                                value="{{ event.end_time.strftime('%H:%M') if event.end_time else '' }}"
                                autocomplete="off">
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-tag text-primary"></i>
                                Etkinlik TÃ¼rÃ¼
                            </span>
                            <input type="text" class="input-shadcn" name="event_type"
                                value="{{ event.event_type or '' }}" placeholder="DÃ¼ÄŸÃ¼n, Konser, Konferans"
                                autocomplete="off">
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-building text-primary"></i>
                                Mekan TÃ¼rÃ¼
                            </span>
                            <select class="input-shadcn" name="venue_type">
                                <option value="">SeÃ§iniz...</option>
                                <option value="salon" {{ 'selected' if event.venue_type=='salon' else '' }}>Salon
                                </option>
                                <option value="saha" {{ 'selected' if event.venue_type=='saha' else '' }}>Saha</option>
                                <option value="sahne" {{ 'selected' if event.venue_type=='sahne' else '' }}>Sahne
                                </option>
                                <option value="kapali_alan" {{ 'selected' if event.venue_type=='kapali_alan' else '' }}>
                                    KapalÄ± Alan</option>
                                <option value="acik_alan" {{ 'selected' if event.venue_type=='acik_alan' else '' }}>AÃ§Ä±k
                                    Alan</option>
                            </select>
                        </label>

                        <label class="md:col-span-2 space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-map-marker-alt text-primary"></i>
                                Mekan AdÄ±
                            </span>
                            <input type="text" class="input-shadcn" name="venue_name"
                                value="{{ event.venue_name or '' }}" placeholder="Ã–rn: Panorama Salon"
                                autocomplete="off">
                        </label>
                    </div>
                </div>
            </section>

            <!-- Mekan ve Sahne KonfigÃ¼rasyonu -->
            <section class="card-shadcn">
                <div class="card-shadcn-header pb-4">
                    <div class="flex items-center gap-3">
                        <span
                            class="inline-flex h-11 w-11 items-center justify-center rounded-xl bg-blue-500/10 text-blue-500">
                            <i class="fas fa-ruler-combined"></i>
                        </span>
                        <div>
                            <h2 class="card-shadcn-title text-xl">Mekan PlanlamasÄ±</h2>
                            <p class="card-shadcn-description">Salon boyutlarÄ± ve sahne konumunu ayarla.</p>
                        </div>
                    </div>
                </div>
                <div class="card-shadcn-content">
                    <div class="grid gap-5 md:grid-cols-3">
                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-arrows-alt-h text-blue-500"></i>
                                GeniÅŸlik (metre)
                            </span>
                            <input type="number" step="0.1" class="input-shadcn" name="venue_width"
                                value="{{ event.venue_width or '' }}" placeholder="0.0" min="0">
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-arrows-alt-v text-blue-500"></i>
                                Uzunluk (metre)
                            </span>
                            <input type="number" step="0.1" class="input-shadcn" name="venue_length"
                                value="{{ event.venue_length or '' }}" placeholder="0.0" min="0">
                        </label>

                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-th-large text-blue-500"></i>
                                Sahne Konumu
                            </span>
                            <select class="input-shadcn" name="stage_position">
                                <option value="top" {{ 'selected' if event.stage_position and
                                    event.stage_position.value=='top' else '' }}>Ãœst</option>
                                <option value="bottom" {{ 'selected' if event.stage_position and
                                    event.stage_position.value=='bottom' else '' }}>Alt
                                </option>
                                <option value="left" {{ 'selected' if event.stage_position and
                                    event.stage_position.value=='left' else '' }}>Sol
                                </option>
                                <option value="right" {{ 'selected' if event.stage_position and
                                    event.stage_position.value=='right' else '' }}>SaÄŸ
                                </option>
                            </select>
                        </label>
                    </div>
                </div>
            </section>

            <!-- Durum YÃ¶netimi -->
            <section class="card-shadcn">
                <div class="card-shadcn-header pb-4">
                    <div class="flex items-center gap-3">
                        <span class="inline-flex h-11 w-11 items-center justify-center rounded-xl 
                                   {{ 'bg-amber-500/10 text-amber-600' if event.status == 'draft' else 
                                      'bg-green-500/10 text-green-600' if event.status == 'active' else
                                      'bg-blue-500/10 text-blue-600' if event.status == 'completed' else
                                      'bg-red-500/10 text-red-600' }}">
                            <i class="fas {{ 'fa-edit' if event.status == 'draft' else 
                                           'fa-play' if event.status == 'active' else
                                           'fa-check' if event.status == 'completed' else
                                           'fa-times' }}"></i>
                        </span>
                        <div>
                            <h2 class="card-shadcn-title text-xl">Etkinlik Durumu</h2>
                            <p class="card-shadcn-description">EtkinliÄŸin mevcut durumunu yÃ¶net ve gÃ¼ncelle.</p>
                        </div>
                    </div>
                </div>
                <div class="card-shadcn-content">
                    <div class="grid gap-5 md:grid-cols-2">
                        <label class="space-y-2">
                            <span
                                class="label-shadcn flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
                                <i class="fas fa-toggle-on text-primary"></i>
                                Durum
                            </span>
                            <select class="input-shadcn" name="status" onchange="updateStatusInfo(this.value)">
                                <option value="draft" {{ 'selected' if event.status=='draft' else '' }}>Taslak</option>
                                <option value="active" {{ 'selected' if event.status=='active' else '' }}>Aktif</option>
                                <option value="completed" {{ 'selected' if event.status=='completed' else '' }}>
                                    TamamlandÄ±</option>
                                <option value="cancelled" {{ 'selected' if event.status=='cancelled' else '' }}>Ä°ptal
                                    Edildi</option>
                            </select>
                        </label>

                        <div id="status-info" class="flex items-center">
                            <div
                                class="flex items-center gap-3 p-4 rounded-xl 
                                         {{ 'bg-amber-50 border border-amber-200 text-amber-700 dark:bg-amber-500/10 dark:border-amber-500/40 dark:text-amber-300' if event.status == 'draft' else
                                            'bg-green-50 border border-green-200 text-green-700 dark:bg-green-500/10 dark:border-green-500/40 dark:text-green-300' if event.status == 'active' else
                                            'bg-blue-50 border border-blue-200 text-blue-700 dark:bg-blue-500/10 dark:border-blue-500/40 dark:text-blue-300' if event.status == 'completed' else
                                            'bg-red-50 border border-red-200 text-red-700 dark:bg-red-500/10 dark:border-red-500/40 dark:text-red-300' }}">
                                <i class="fas {{ 'fa-info-circle' if event.status == 'draft' else 
                                               'fa-check-circle' if event.status == 'active' else
                                               'fa-check-double' if event.status == 'completed' else
                                               'fa-exclamation-triangle' }}"></i>
                                <span class="text-sm font-medium" id="status-text">
                                    {{ 'Etkinlik taslak aÅŸamasÄ±nda' if event.status == 'draft' else
                                    'Etkinlik aktif ve rezervasyona aÃ§Ä±k' if event.status == 'active' else
                                    'Etkinlik baÅŸarÄ±yla tamamlandÄ±' if event.status == 'completed' else
                                    'Etkinlik iptal edildi' }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- GÃ¶rsel Oturum DÃ¼zenleme -->
            <section class="card-shadcn">
                <div class="card-shadcn-header pb-4">
                    <div class="flex items-center gap-3">
                        <span
                            class="inline-flex h-11 w-11 items-center justify-center rounded-xl bg-purple-500/10 text-purple-500">
                            <i class="fas fa-paint-brush"></i>
                        </span>
                        <div>
                            <h2 class="card-shadcn-title text-xl">GÃ¶rsel Oturum DÃ¼zenleme</h2>
                            <p class="card-shadcn-description">SÃ¼rÃ¼kle-bÄ±rak ile oturumlarÄ± yerleÅŸtir, sahne konumunu
                                ayarla.</p>
                        </div>
                    </div>
                </div>
                <div class="card-shadcn-content">
                    <div class="grid gap-6 lg:grid-cols-[1fr,300px]">
                        <!-- Visual Editor Container -->
                        <div class="space-y-4">
                            <div id="visual-editor-container" class="visual-editor-wrapper">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">Oturum PlanÄ±</h3>
                                    <div class="flex gap-2">
                                        <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                            onclick="openTemplateModal()">
                                            <i class="fas fa-download"></i>
                                            Åžablondan YÃ¼kle
                                        </button>
                                        <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                            onclick="saveAsTemplate()">
                                            <i class="fas fa-save"></i>
                                            Åžablon Kaydet
                                        </button>
                                        <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-default"
                                            onclick="saveLayout()">
                                            <i class="fas fa-check"></i>
                                            Kaydet
                                        </button>
                                    </div>
                                </div>
                                <div id="visual-seating-editor"
                                    class="border border-slate-200 rounded-lg bg-white dark:border-slate-700 dark:bg-slate-800">
                                    <!-- Visual editor will be initialized here -->
                                </div>
                            </div>
                        </div>

                        <!-- Oturum Tipleri Paneli -->
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                <i class="fas fa-layer-group text-purple-500"></i>
                                Oturum Tipleri
                            </h3>
                            <div class="space-y-3" id="seating-types-panel">
                                <!-- Seating types will be loaded here -->
                            </div>

                            <!-- Canvas AyarlarÄ± -->
                            <div class="border-t pt-4">
                                <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">Canvas
                                    AyarlarÄ±</h4>
                                <div class="space-y-3">
                                    <label class="space-y-1">
                                        <span class="text-xs text-slate-600 dark:text-slate-400">GeniÅŸlik</span>
                                        <input type="number" class="input-shadcn input-sm" id="canvas-width" value="800"
                                            min="400" max="2000">
                                    </label>
                                    <label class="space-y-1">
                                        <span class="text-xs text-slate-600 dark:text-slate-400">YÃ¼kseklik</span>
                                        <input type="number" class="input-shadcn input-sm" id="canvas-height"
                                            value="600" min="300" max="1500">
                                    </label>
                                    <label class="space-y-1">
                                        <span class="text-xs text-slate-600 dark:text-slate-400">Grid Boyutu</span>
                                        <input type="number" class="input-shadcn input-sm" id="grid-size" value="20"
                                            min="10" max="100">
                                    </label>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-default w-full"
                                        onclick="updateCanvasSettings()">
                                        <i class="fas fa-cog"></i>
                                        AyarlarÄ± Uygula
                                    </button>
                                </div>
                            </div>

                            <!-- AraÃ§lar -->
                            <div class="border-t pt-4">
                                <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">AraÃ§lar</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="undoAction()" id="undo-btn" title="Geri Al (Ctrl+Z)">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="redoAction()" id="redo-btn" title="Ä°leri Al (Ctrl+Y)">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="zoomIn()" title="YakÄ±nlaÅŸtÄ±r">
                                        <i class="fas fa-search-plus"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="zoomOut()" title="UzaklaÅŸtÄ±r">
                                        <i class="fas fa-search-minus"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="resetZoom()" title="Zoom SÄ±fÄ±rla">
                                        <i class="fas fa-expand-arrows-alt"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="toggleGrid()" id="toggle-grid-btn" title="KÄ±lavuz Ã‡izgileri">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="autoArrange()" title="Otomatik DÃ¼zenle">
                                        <i class="fas fa-magic"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="resolveCollisions()" title="Ã‡akÄ±ÅŸmalarÄ± Ã‡Ã¶z">
                                        <i class="fas fa-compress-arrows-alt"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="clearCanvas()" title="TÃ¼mÃ¼nÃ¼ Temizle">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="duplicateSelected()" title="SeÃ§ili Oturumu Ã‡oÄŸalt (Ctrl+D)">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Hizalama AraÃ§larÄ± -->
                            <div class="border-t pt-4">
                                <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">Hizalama</h4>
                                <div class="grid grid-cols-3 gap-2">
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="alignLeft()" title="Sola Hizala">
                                        <i class="fas fa-align-left"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="alignCenter()" title="Ortaya Hizala">
                                        <i class="fas fa-align-center"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="alignRight()" title="SaÄŸa Hizala">
                                        <i class="fas fa-align-right"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="alignTop()" title="Ãœste Hizala">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="alignMiddle()" title="Dikey Ortala">
                                        <i class="fas fa-arrows-alt-v"></i>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="alignBottom()" title="Alta Hizala">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- DaÄŸÄ±tÄ±m AraÃ§larÄ± -->
                            <div class="border-t pt-4">
                                <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">DaÄŸÄ±tÄ±m</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="distributeHorizontally()" title="Yatay DaÄŸÄ±t">
                                        <i class="fas fa-arrows-alt-h"></i>
                                        <span class="text-xs">Yatay</span>
                                    </button>
                                    <button type="button" class="btn-shadcn btn-shadcn-sm btn-shadcn-outline"
                                        onclick="distributeVertically()" title="Dikey DaÄŸÄ±t">
                                        <i class="fas fa-arrows-alt-v"></i>
                                        <span class="text-xs">Dikey</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Kapasite GÃ¶stergesi -->
                            <div class="border-t pt-4">
                                <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3">Kapasite Bilgisi</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-users text-blue-500"></i>
                                            <span class="text-sm text-slate-700 dark:text-slate-200">Toplam Kapasite</span>
                                        </div>
                                        <span class="text-lg font-bold text-slate-900 dark:text-white" id="total-capacity">0</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-chair text-purple-500"></i>
                                            <span class="text-sm text-slate-700 dark:text-slate-200">Oturum SayÄ±sÄ±</span>
                                        </div>
                                        <span class="text-lg font-bold text-slate-900 dark:text-white" id="seating-count">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Eylemler -->
            <section
                class="card-shadcn border border-dashed border-slate-200 bg-slate-50 dark:border-slate-800 dark:bg-slate-900/40">
                <div class="card-shadcn-content">
                    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                        <div class="flex items-center gap-4 text-slate-600 dark:text-slate-300">
                            <span
                                class="inline-flex h-12 w-12 items-center justify-center rounded-full bg-blue-500/10 text-blue-500">
                                <i class="fas fa-save"></i>
                            </span>
                            <div>
                                <p class="text-sm font-semibold text-slate-800 dark:text-white">DeÄŸiÅŸiklikleri Kaydet
                                </p>
                                <p class="text-xs text-slate-500 dark:text-slate-400">TÃ¼m deÄŸiÅŸikliklerin kaydedilmesi
                                    iÃ§in onayla.</p>
                            </div>
                        </div>
                        <div class="flex w-full flex-col gap-2 sm:w-auto sm:flex-row">
                            <a href="{{ url_for('event.index') }}" class="btn-shadcn btn-shadcn-outline">
                                <i class="fas fa-times"></i>
                                <span>Ä°ptal</span>
                            </a>
                            <button type="submit" class="btn-shadcn btn-shadcn-default">
                                <i class="fas fa-check"></i>
                                <span>DeÄŸiÅŸiklikleri Kaydet</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tehlikeli Ä°ÅŸlemler -->
            <section class="card-shadcn border border-red-200 bg-red-50/50 dark:border-red-900/40 dark:bg-red-900/10">
                <div class="card-shadcn-header pb-4">
                    <div class="flex items-center gap-3">
                        <span
                            class="inline-flex h-11 w-11 items-center justify-center rounded-xl bg-red-500/10 text-red-500">
                            <i class="fas fa-exclamation-triangle"></i>
                        </span>
                        <div>
                            <h2 class="card-shadcn-title text-xl text-red-700 dark:text-red-300">Tehlikeli Ä°ÅŸlemler</h2>
                            <p class="card-shadcn-description text-red-600 dark:text-red-400">Bu iÅŸlemler geri alÄ±namaz.
                                Dikkatli olun.</p>
                        </div>
                    </div>
                </div>
                <div class="card-shadcn-content">
                    <div class="grid gap-4 md:grid-cols-2">
                        <!-- Etkinlik Ä°ptal -->
                        <div class="space-y-3">
                            <h3 class="text-sm font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                                <i class="fas fa-ban text-amber-500"></i>
                                Etkinlik Ä°ptal
                            </h3>
                            <p class="text-xs text-slate-600 dark:text-slate-400">
                                EtkinliÄŸi iptal eder ve tÃ¼m aktif rezervasyonlarÄ± otomatik olarak iptal eder.
                            </p>
                            <form method="POST" action="{{ url_for('event.cancel', event_id=event.id) }}"
                                class="inline">
                                <button type="submit"
                                    onclick="return confirm('Bu etkinliÄŸi iptal etmek istediÄŸinizden emin misiniz? TÃ¼m aktif rezervasyonlar da iptal edilecek.')"
                                    class="btn-shadcn btn-shadcn-outline text-amber-600 border-amber-300 hover:bg-amber-50 dark:text-amber-400 dark:border-amber-600"
                                    {% if event.status=='cancelled' %}disabled{% endif %}>
                                    <i class="fas fa-ban"></i>
                                    <span>EtkinliÄŸi Ä°ptal Et</span>
                                </button>
                            </form>
                        </div>

                        <!-- Etkinlik Silme -->
                        <div class="space-y-3">
                            <h3 class="text-sm font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                                <i class="fas fa-trash text-red-500"></i>
                                Etkinlik Sil
                            </h3>
                            <p class="text-xs text-slate-600 dark:text-slate-400">
                                EtkinliÄŸi kalÄ±cÄ± olarak siler. YalnÄ±zca rezervasyonsuz etkinlikler silinebilir.
                            </p>
                            <form method="POST" action="{{ url_for('event.delete', event_id=event.id) }}"
                                class="inline">
                                <button type="submit"
                                    onclick="return confirm('Bu etkinliÄŸi kalÄ±cÄ± olarak silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz!')"
                                    class="btn-shadcn btn-shadcn-outline text-red-600 border-red-300 hover:bg-red-50 dark:text-red-400 dark:border-red-600"
                                    {% if event.reservations|length> 0 %}disabled title="Bu etkinliÄŸe ait rezervasyonlar
                                    var"{% endif %}>
                                    <i class="fas fa-trash"></i>
                                    <span>EtkinliÄŸi Sil</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </form>

        <aside class="space-y-6">
            <!-- Etkinlik Durumu -->
            <div class="card-shadcn">
                <div class="card-shadcn-content space-y-4">
                    <h3 class="text-sm font-semibold text-slate-900 dark:text-white">HÄ±zlÄ± Ä°ÅŸlemler</h3>
                    <div class="space-y-3">
                        <a href="{{ url_for('reservation.index') }}"
                            class="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-2 transition hover:border-primary dark:border-slate-800">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-ticket-alt text-primary"></i>
                                Rezervasyonlar
                            </span>
                            <i class="fas fa-arrow-right"></i>
                        </a>

                        <a href="{{ url_for('report.index') }}"
                            class="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-2 transition hover:border-primary dark:border-slate-800">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-chart-pie text-primary"></i>
                                Rapor
                            </span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Ä°puÃ§larÄ± -->
            <div class="card-shadcn bg-gradient-to-br from-blue-500/10 via-transparent to-purple-500/10">
                <div class="card-shadcn-content space-y-4">
                    <div class="flex items-start gap-3">
                        <span
                            class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-blue-500/10 text-blue-500">
                            <i class="fas fa-lightbulb"></i>
                        </span>
                        <div class="space-y-2">
                            <h3 class="text-sm font-semibold text-slate-900 dark:text-white">DÃ¼zenleme Ä°puÃ§larÄ±</h3>
                            <ul class="space-y-2 text-xs leading-relaxed text-slate-600 dark:text-slate-300">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check mt-0.5 text-green-500"></i>
                                    <span>Etkinlik durumunu 'Aktif' yaparak rezervasyonlarÄ± aÃ§abilirsin.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check mt-0.5 text-green-500"></i>
                                    <span>Mekan boyutlarÄ±nÄ± gerÃ§ek Ã¶lÃ§Ã¼lerde girmen koltuk planlamasÄ±nÄ±
                                        kolaylaÅŸtÄ±rÄ±r.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check mt-0.5 text-green-500"></i>
                                    <span>Sahne konumu koltuk yerleÅŸimini doÄŸrudan etkiler.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Etkinlik Bilgileri -->
            <div class="card-shadcn">
                <div class="card-shadcn-content space-y-4">
                    <h3 class="text-sm font-semibold text-slate-900 dark:text-white">Etkinlik Bilgileri</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-center justify-between">
                            <span class="text-slate-600 dark:text-slate-400">OluÅŸturulma:</span>
                            <span class="font-medium text-slate-900 dark:text-white">
                                {{ event.created_at.strftime('%d.%m.%Y %H:%M') if event.created_at else 'Bilinmiyor' }}
                            </span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-slate-600 dark:text-slate-400">Son GÃ¼ncelleme:</span>
                            <span class="font-medium text-slate-900 dark:text-white">
                                {{ event.updated_at.strftime('%d.%m.%Y %H:%M') if event.updated_at else 'Bilinmiyor' }}
                            </span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-slate-600 dark:text-slate-400">Rezervasyonlar:</span>
                            <span class="font-medium text-slate-900 dark:text-white">
                                {{ event.reservations|length if event.reservations else 0 }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>

<!-- Åžablon SeÃ§ici Modal -->
<div id="template-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
    <div class="relative mx-4 w-full max-w-2xl rounded-xl bg-white shadow-2xl dark:bg-slate-900">
        <div class="flex items-center justify-between border-b border-slate-200 p-6 dark:border-slate-700">
            <div class="flex items-center gap-3">
                <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 text-primary">
                    <i class="fas fa-layer-group"></i>
                </span>
                <div>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white">Åžablon SeÃ§</h3>
                    <p class="text-sm text-slate-600 dark:text-slate-400">KayÄ±tlÄ± ÅŸablonlardan birini yÃ¼kle</p>
                </div>
            </div>
            <button type="button" onclick="closeTemplateModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="max-h-96 overflow-y-auto p-6">
            <div id="template-list" class="space-y-3">
                <!-- Templates will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Åžablon Kaydetme Modal -->
<div id="save-template-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
    <div class="relative mx-4 w-full max-w-md rounded-xl bg-white shadow-2xl dark:bg-slate-900">
        <div class="flex items-center justify-between border-b border-slate-200 p-6 dark:border-slate-700">
            <div class="flex items-center gap-3">
                <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg bg-green-500/10 text-green-500">
                    <i class="fas fa-save"></i>
                </span>
                <div>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white">Åžablon Kaydet</h3>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Mevcut dÃ¼zeni ÅŸablon olarak kaydet</p>
                </div>
            </div>
            <button type="button" onclick="closeSaveTemplateModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="save-template-form" class="space-y-4">
                <label class="space-y-2">
                    <span class="label-shadcn">Åžablon AdÄ±</span>
                    <input type="text" id="template-name" class="input-shadcn" placeholder="Ã–rn: DÃ¼ÄŸÃ¼n Salonu Standart" required>
                </label>
                <label class="space-y-2">
                    <span class="label-shadcn">AÃ§Ä±klama</span>
                    <textarea id="template-description" class="textarea-shadcn" rows="3" placeholder="Åžablon hakkÄ±nda kÄ±sa aÃ§Ä±klama..."></textarea>
                </label>
                <label class="space-y-2">
                    <span class="label-shadcn">Kategori</span>
                    <select id="template-category" class="input-shadcn">
                        <option value="general">Genel</option>
                        <option value="wedding">DÃ¼ÄŸÃ¼n</option>
                        <option value="conference">Konferans</option>
                        <option value="concert">Konser</option>
                        <option value="other">DiÄŸer</option>
                    </select>
                </label>
                <div class="flex gap-3">
                    <button type="button" onclick="closeSaveTemplateModal()" class="btn-shadcn btn-shadcn-outline flex-1">
                        <i class="fas fa-times"></i>
                        Ä°ptal
                    </button>
                    <button type="submit" class="btn-shadcn btn-shadcn-default flex-1">
                        <i class="fas fa-save"></i>
                        Kaydet
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/visual-editor.js') }}"></script>
<script>
    let visualEditor = null;
    let currentSeatingTypes = [];

    // Initialize visual editor when page loads
    document.addEventListener( 'DOMContentLoaded', function () {
        initializeVisualEditor();
        loadSeatingTypes();
        loadCurrentLayout();
    } );

    function initializeVisualEditor() {
        const container = document.getElementById( 'visual-seating-editor' );
        if ( container ) {
            visualEditor = new VisualSeatingEditor( 'visual-seating-editor', {
                width: 800,
                height: 600,
                gridSize: 20,
                stagePosition: '{{ event.stage_position.value if event.stage_position else "top" }}'
            } );
        }
    }

    function loadSeatingTypes() {
        fetch( `/event/{{ event.id }}/seating-config` )
            .then( response => response.json() )
            .then( data => {
                if ( data.success ) {
                    currentSeatingTypes = data.data.seating_types;
                    renderSeatingTypesPanel();
                }
            } )
            .catch( error => {
                console.error( 'Error loading seating types:', error );
            } );
    }

    function renderSeatingTypesPanel() {
        const panel = document.getElementById( 'seating-types-panel' );
        panel.innerHTML = '';

        currentSeatingTypes.forEach( type => {
            const element = document.createElement( 'div' );
            element.className = 'flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:border-purple-300 cursor-pointer dark:border-slate-700';
            element.onclick = () => addSeatingToCanvas( type );

            element.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-2xl">${type.icon || 'ðŸª‘'}</span>
                    <div>
                        <p class="text-sm font-medium text-slate-900 dark:text-white">${type.name}</p>
                        <p class="text-xs text-slate-500 dark:text-slate-400">${type.capacity} kiÅŸi</p>
                    </div>
                </div>
                <div class="w-4 h-4 rounded" style="background-color: ${type.color_code || '#3498db'}"></div>
            `;

            panel.appendChild( element );
        } );
    }

    function addSeatingToCanvas( seatingType ) {
        if ( visualEditor ) {
            console.log( 'ðŸŽ¯ Masa ekleniyor:', seatingType );

            const position = { x: 100, y: 100 };
            const config = {
                name: `${seatingType.name} ${visualEditor.seatings.length + 1}`,
                width: seatingType.seat_type === 'table' ? 60 : 30,
                height: seatingType.seat_type === 'table' ? 40 : 30,
                capacity: seatingType.capacity,
                color: seatingType.color_code || '#3498db',
                icon: seatingType.icon || 'ðŸª‘',
                type: seatingType.seat_type
            };

            console.log( 'ðŸ“ Masa config:', config );
            const result = visualEditor.addSeating( seatingType.seat_type, position, config );
            console.log( 'âœ… Masa eklendi:', result );
            console.log( 'ðŸ“Š Toplam masa sayÄ±sÄ±:', visualEditor.seatings.length );
            
            updateCapacityInfo();
        } else {
            console.error( 'âŒ Visual editor bulunamadÄ±!' );
        }
    }

    function updateCapacityInfo() {
        if ( !visualEditor ) return;

        const totalCapacity = visualEditor.seatings.reduce( ( sum, seat ) => sum + ( seat.capacity || 0 ), 0 );
        const seatingCount = visualEditor.seatings.length;

        document.getElementById( 'total-capacity' ).textContent = totalCapacity;
        document.getElementById( 'seating-count' ).textContent = seatingCount;
    }

    function loadCurrentLayout() {
        fetch( `/event/{{ event.id }}/seating-config` )
            .then( response => response.json() )
            .then( data => {
                if ( data.success && visualEditor ) {
                    const config = data.data;

                    // Update canvas settings
                    if ( config.canvas ) {
                        document.getElementById( 'canvas-width' ).value = config.canvas.width;
                        document.getElementById( 'canvas-height' ).value = config.canvas.height;
                        document.getElementById( 'grid-size' ).value = config.canvas.grid_size;
                    }

                    // Load seatings
                    if ( config.seatings && config.seatings.length > 0 ) {
                        visualEditor.loadSeatingsData( config.seatings );
                        updateCapacityInfo();
                    }
                }
            } )
            .catch( error => {
                console.error( 'Error loading current layout:', error );
            } );
    }

    function saveLayout() {
        if ( !visualEditor ) {
            console.error( 'âŒ Visual editor bulunamadÄ±!' );
            return;
        }

        console.log( 'ðŸ’¾ DÃ¼zen kaydediliyor...' );
        console.log( 'ðŸ“Š Mevcut masalar:', visualEditor.seatings );

        const config = visualEditor.getConfiguration();
        console.log( 'âš™ï¸ Configuration:', config );

        const data = {
            canvas_width: parseInt( document.getElementById( 'canvas-width' ).value ),
            canvas_height: parseInt( document.getElementById( 'canvas-height' ).value ),
            grid_size: parseInt( document.getElementById( 'grid-size' ).value ),
            stage_position: config.stagePosition,
            seats: config.seatings.map( seat => {
                const seatingTypeId = findSeatingTypeId( seat.type, seat.capacity );
                console.log( `ðŸ” Masa ${seat.name}: type=${seat.type}, capacity=${seat.capacity}, seating_type_id=${seatingTypeId}` );
                return {
                    seating_type_id: seatingTypeId,
                    seat_number: seat.name,
                    position_x: seat.x,
                    position_y: seat.y,
                    width: seat.width,
                    height: seat.height,
                    color_code: seat.color
                };
            } )
        };

        console.log( 'ðŸ“¤ GÃ¶nderilecek data:', data );

        fetch( `/event/{{ event.id }}/save-layout`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify( data )
        } )
            .then( response => {
                console.log( 'ðŸ“¥ Response status:', response.status );
                return response.json();
            } )
            .then( result => {
                console.log( 'ðŸ“¥ Response:', result );
                if ( result.success ) {
                    showNotification( 'GÃ¶rsel plan baÅŸarÄ±yla kaydedildi!', 'success' );
                } else {
                    showNotification( 'Kaydetme hatasÄ±: ' + result.message, 'error' );
                }
            } )
            .catch( error => {
                console.error( 'âŒ Error saving layout:', error );
                showNotification( 'Kaydetme sÄ±rasÄ±nda hata oluÅŸtu', 'error' );
            } );
    }

    function findSeatingTypeId( type, capacity ) {
        const type_match = currentSeatingTypes.find( t => t.seat_type === type && t.capacity === capacity );
        return type_match ? type_match.id : 1; // Default to first type if not found
    }

    function updateCanvasSettings() {
        if ( !visualEditor ) return;

        const width = parseInt( document.getElementById( 'canvas-width' ).value );
        const height = parseInt( document.getElementById( 'canvas-height' ).value );
        const gridSize = parseInt( document.getElementById( 'grid-size' ).value );

        // Update visual editor settings
        visualEditor.config.width = width;
        visualEditor.config.height = height;
        visualEditor.config.gridSize = gridSize;

        // Recreate canvas
        const container = document.getElementById( 'visual-seating-editor' );
        container.innerHTML = '';
        initializeVisualEditor();

        showNotification( 'Canvas ayarlarÄ± gÃ¼ncellendi', 'success' );
    }

    function zoomIn() {
        if ( visualEditor ) visualEditor.zoomIn();
    }

    function zoomOut() {
        if ( visualEditor ) visualEditor.zoomOut();
    }

    function resetZoom() {
        if ( visualEditor ) visualEditor.zoomReset();
    }

    function toggleGrid() {
        if ( !visualEditor ) return;

        visualEditor.gridVisible = !visualEditor.gridVisible;

        // Update button style
        const btn = document.getElementById( 'toggle-grid-btn' );
        if ( visualEditor.gridVisible ) {
            btn.classList.add( 'btn-shadcn-default' );
            btn.classList.remove( 'btn-shadcn-outline' );
            visualEditor.gridCanvas.style.display = 'block';
        } else {
            btn.classList.remove( 'btn-shadcn-default' );
            btn.classList.add( 'btn-shadcn-outline' );
            visualEditor.gridCanvas.style.display = 'none';
        }
    }

    function clearCanvas() {
        if ( visualEditor && confirm( 'TÃ¼m oturumlarÄ± silmek istediÄŸinizden emin misiniz?' ) ) {
            visualEditor.seatings = [];
            visualEditor.draw();
            updateCapacityInfo();
        }
    }

    function duplicateSelected() {
        if ( !visualEditor || !visualEditor.selectedSeating ) {
            showNotification( 'Ã–nce bir oturum seÃ§in', 'info' );
            return;
        }

        visualEditor.duplicateSeating( visualEditor.selectedSeating );
        updateCapacityInfo();
        showNotification( 'Oturum Ã§oÄŸaltÄ±ldÄ±', 'success' );
    }

    // Alignment functions
    function alignLeft() {
        if ( !visualEditor ) return;
        visualEditor.alignLeft();
        showNotification( 'Sola hizalandÄ±', 'success' );
    }

    function alignRight() {
        if ( !visualEditor ) return;
        visualEditor.alignRight();
        showNotification( 'SaÄŸa hizalandÄ±', 'success' );
    }

    function alignTop() {
        if ( !visualEditor ) return;
        visualEditor.alignTop();
        showNotification( 'Ãœste hizalandÄ±', 'success' );
    }

    function alignBottom() {
        if ( !visualEditor ) return;
        visualEditor.alignBottom();
        showNotification( 'Alta hizalandÄ±', 'success' );
    }

    function alignCenter() {
        if ( !visualEditor ) return;
        visualEditor.alignCenter();
        showNotification( 'Ortaya hizalandÄ±', 'success' );
    }

    function alignMiddle() {
        if ( !visualEditor ) return;
        visualEditor.alignMiddle();
        showNotification( 'Dikey ortalandÄ±', 'success' );
    }

    // Distribution functions
    function distributeHorizontally() {
        if ( !visualEditor ) return;
        if ( visualEditor.seatings.length < 3 ) {
            showNotification( 'En az 3 oturum gerekli', 'warning' );
            return;
        }
        visualEditor.distributeHorizontally();
        showNotification( 'Yatay daÄŸÄ±tÄ±ldÄ±', 'success' );
    }

    function distributeVertically() {
        if ( !visualEditor ) return;
        if ( visualEditor.seatings.length < 3 ) {
            showNotification( 'En az 3 oturum gerekli', 'warning' );
            return;
        }
        visualEditor.distributeVertically();
        showNotification( 'Dikey daÄŸÄ±tÄ±ldÄ±', 'success' );
    }

    function saveAsTemplate() {
        if ( !visualEditor || visualEditor.seatings.length === 0 ) {
            showNotification( 'Kaydetmek iÃ§in en az bir oturum ekleyin', 'warning' );
            return;
        }
        openSaveTemplateModal();
    }

    function openSaveTemplateModal() {
        document.getElementById( 'save-template-modal' ).classList.remove( 'hidden' );
        document.getElementById( 'save-template-modal' ).classList.add( 'flex' );
    }

    function closeSaveTemplateModal() {
        document.getElementById( 'save-template-modal' ).classList.add( 'hidden' );
        document.getElementById( 'save-template-modal' ).classList.remove( 'flex' );
        document.getElementById( 'save-template-form' ).reset();
    }

    document.getElementById( 'save-template-form' ).addEventListener( 'submit', function ( e ) {
        e.preventDefault();

        const data = {
            name: document.getElementById( 'template-name' ).value,
            description: document.getElementById( 'template-description' ).value,
            category: document.getElementById( 'template-category' ).value
        };

        fetch( `/event/{{ event.id }}/template/save`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify( data )
        } )
            .then( response => response.json() )
            .then( result => {
                if ( result.success ) {
                    showNotification( 'Åžablon baÅŸarÄ±yla kaydedildi!', 'success' );
                    closeSaveTemplateModal();
                } else {
                    showNotification( 'Åžablon kaydetme hatasÄ±: ' + result.message, 'error' );
                }
            } )
            .catch( error => {
                console.error( 'Error saving template:', error );
                showNotification( 'Åžablon kaydetme sÄ±rasÄ±nda hata oluÅŸtu', 'error' );
            } );
    } );

    function openTemplateModal() {
        document.getElementById( 'template-modal' ).classList.remove( 'hidden' );
        document.getElementById( 'template-modal' ).classList.add( 'flex' );
        loadTemplateList();
    }

    function closeTemplateModal() {
        document.getElementById( 'template-modal' ).classList.add( 'hidden' );
        document.getElementById( 'template-modal' ).classList.remove( 'flex' );
    }

    function loadTemplateList() {
        fetch( '/template/api/list' )
            .then( response => response.json() )
            .then( data => {
                const templateList = document.getElementById( 'template-list' );
                
                if ( !data.templates || data.templates.length === 0 ) {
                    templateList.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-inbox text-4xl text-slate-300 dark:text-slate-600 mb-3"></i>
                            <p class="text-slate-600 dark:text-slate-400">HenÃ¼z kayÄ±tlÄ± ÅŸablon yok</p>
                        </div>
                    `;
                    return;
                }

                templateList.innerHTML = data.templates.map( template => `
                    <div class="flex items-center justify-between p-4 border border-slate-200 rounded-lg hover:border-primary transition dark:border-slate-700">
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-900 dark:text-white">${template.name}</h4>
                            <p class="text-sm text-slate-600 dark:text-slate-400">${template.description || 'AÃ§Ä±klama yok'}</p>
                            <div class="flex items-center gap-3 mt-2">
                                <span class="text-xs px-2 py-1 rounded bg-primary/10 text-primary">${template.category || 'Genel'}</span>
                                <span class="text-xs text-slate-500">${template.seating_count || 0} oturum</span>
                            </div>
                        </div>
                        <button type="button" onclick="loadFromTemplate(${template.id})" class="btn-shadcn btn-shadcn-sm btn-shadcn-default">
                            <i class="fas fa-download"></i>
                            YÃ¼kle
                        </button>
                    </div>
                `).join( '' );
            } )
            .catch( error => {
                console.error( 'Error loading templates:', error );
                showNotification( 'Åžablonlar yÃ¼klenemedi', 'error' );
            } );
    }

    function loadFromTemplate( templateId ) {
        if ( visualEditor.seatings.length > 0 ) {
            if ( !confirm( 'Mevcut dÃ¼zen silinecek. Devam etmek istiyor musunuz?' ) ) {
                return;
            }
        }

        fetch( `/event/template/${templateId}/load`, {
            method: 'POST'
        } )
            .then( response => response.json() )
            .then( result => {
                if ( result.success && visualEditor ) {
                    visualEditor.loadConfiguration( result.data );
                    updateCapacityInfo();
                    showNotification( 'Åžablon baÅŸarÄ±yla yÃ¼klendi!', 'success' );
                    closeTemplateModal();
                } else {
                    showNotification( 'Åžablon yÃ¼kleme hatasÄ±: ' + result.message, 'error' );
                }
            } )
            .catch( error => {
                console.error( 'Error loading template:', error );
                showNotification( 'Åžablon yÃ¼kleme sÄ±rasÄ±nda hata oluÅŸtu', 'error' );
            } );
    }

    function showNotification( message, type = 'info' ) {
        // Simple notification - you might want to use a proper toast library
        const notification = document.createElement( 'div' );
        notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${type === 'success' ? 'bg-green-500 text-white' :
            type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
        notification.textContent = message;

        document.body.appendChild( notification );

        setTimeout( () => {
            notification.remove();
        }, 3000 );
    }

    function updateStatusInfo( status ) {
        const statusText = document.getElementById( 'status-text' );
        const statusDiv = statusText.closest( 'div' );

        // Remove all status classes
        statusDiv.className = statusDiv.className.replace( /bg-\w+-\d+|border-\w+-\d+|text-\w+-\d+|dark:bg-\w+-\d+|dark:border-\w+-\d+|dark:text-\w+-\d+/g, '' );

        let text = '';
        let classes = '';

        switch ( status ) {
            case 'draft':
                text = 'Etkinlik taslak aÅŸamasÄ±nda';
                classes = 'bg-amber-50 border border-amber-200 text-amber-700 dark:bg-amber-500/10 dark:border-amber-500/40 dark:text-amber-300';
                break;
            case 'active':
                text = 'Etkinlik aktif ve rezervasyona aÃ§Ä±k';
                classes = 'bg-green-50 border border-green-200 text-green-700 dark:bg-green-500/10 dark:border-green-500/40 dark:text-green-300';
                break;
            case 'completed':
                text = 'Etkinlik baÅŸarÄ±yla tamamlandÄ±';
                classes = 'bg-blue-50 border border-blue-200 text-blue-700 dark:bg-blue-500/10 dark:border-blue-500/40 dark:text-blue-300';
                break;
            case 'cancelled':
                text = 'Etkinlik iptal edildi';
                classes = 'bg-red-50 border border-red-200 text-red-700 dark:bg-red-500/10 dark:border-red-500/40 dark:text-red-300';
                break;
        }

        statusText.textContent = text;
        statusDiv.className += ' ' + classes;
    }

    // Visual Editor Enhancement Functions
    function undoAction() {
        if ( visualEditor && visualEditor.undo() ) {
            updateUndoRedoButtons();
            showNotification( 'Ä°ÅŸlem geri alÄ±ndÄ±', 'success' );
        } else {
            showNotification( 'Geri alÄ±nacak iÅŸlem yok', 'info' );
        }
    }

    function redoAction() {
        if ( visualEditor && visualEditor.redo() ) {
            updateUndoRedoButtons();
            showNotification( 'Ä°ÅŸlem ileri alÄ±ndÄ±', 'success' );
        } else {
            showNotification( 'Ä°leri alÄ±nacak iÅŸlem yok', 'info' );
        }
    }

    function autoArrange() {
        if ( visualEditor ) {
            visualEditor.autoArrange();
            updateUndoRedoButtons();
            showNotification( 'Otomatik dÃ¼zenleme tamamlandÄ±', 'success' );
        }
    }

    function resolveCollisions() {
        if ( visualEditor && visualEditor.selectedSeating ) {
            const success = visualEditor.resolveCollisions( visualEditor.selectedSeating );
            if ( success ) {
                visualEditor.draw();
                showNotification( 'Ã‡akÄ±ÅŸma Ã§Ã¶zÃ¼ldÃ¼', 'success' );
            } else {
                showNotification( 'Ã‡akÄ±ÅŸma Ã§Ã¶zÃ¼lemedi', 'warning' );
            }
        } else {
            showNotification( 'Ã–nce bir oturum seÃ§in', 'info' );
        }
    }

    function updateUndoRedoButtons() {
        const undoBtn = document.getElementById( 'undo-btn' );
        const redoBtn = document.getElementById( 'redo-btn' );

        // Null check - buttons might not exist yet
        if ( !undoBtn || !redoBtn ) {
            return;
        }

        if ( visualEditor ) {
            undoBtn.disabled = !visualEditor.canUndo();
            redoBtn.disabled = !visualEditor.canRedo();

            if ( undoBtn.disabled ) {
                undoBtn.classList.add( 'opacity-50', 'cursor-not-allowed' );
            } else {
                undoBtn.classList.remove( 'opacity-50', 'cursor-not-allowed' );
            }

            if ( redoBtn.disabled ) {
                redoBtn.classList.add( 'opacity-50', 'cursor-not-allowed' );
            } else {
                redoBtn.classList.remove( 'opacity-50', 'cursor-not-allowed' );
            }
        }
    }

    // Add keyboard shortcuts
    document.addEventListener( 'keydown', function ( e ) {
        if ( e.ctrlKey || e.metaKey ) {
            switch ( e.key ) {
                case 'z':
                    if ( !e.shiftKey ) {
                        e.preventDefault();
                        undoAction();
                    }
                    break;
                case 'y':
                case 'Z':
                    if ( e.shiftKey || e.key === 'y' ) {
                        e.preventDefault();
                        redoAction();
                    }
                    break;
            }
        }
    } );

    // Initialize undo/redo buttons when editor is ready
    document.addEventListener( 'DOMContentLoaded', function () {
        setTimeout( updateUndoRedoButtons, 1000 ); // Wait for editor to initialize
    } );
</script>
{% endblock %}