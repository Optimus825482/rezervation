{% extends "base.html" %}
{% block title %}Etkinlik DÃ¼zenle: {{ event.name }}{% endblock %}

{% block extra_css %}
<link href="/static/css/context-menu.css" rel="stylesheet">
<style>
    .setup-wizard {
        display: none;
    }

    .setup-wizard.active {
        display: block;
    }

    #seating-canvas {
        position: relative;
        margin: 0 auto;
        cursor: crosshair;
        border-radius: 1rem;
        border: 2px dashed hsl(var(--border));
        background: hsl(var(--card));
        box-shadow: inset 0 1px 6px rgba(15, 23, 42, 0.08);
    }

    #seating-canvas.grid-enabled {
        background-image:
            repeating-linear-gradient(0deg, transparent, transparent 49px, rgba(148, 163, 184, 0.15) 49px, rgba(148, 163, 184, 0.25) 50px),
            repeating-linear-gradient(90deg, transparent, transparent 49px, rgba(148, 163, 184, 0.15) 49px, rgba(148, 163, 184, 0.25) 50px);
        background-size: 50px 50px;
    }

    .seat {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: move;
        color: #fff;
        font-weight: 700;
        user-select: none;
        border: 3px solid rgba(255, 255, 255, 0.2);
        box-shadow: 
            0 8px 16px rgba(0, 0, 0, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.2),
            inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(4px);
    }

    .seat.table {
        border-radius: 1rem;
        padding: 0.5rem;
    }

    .seat.loca {
        border-radius: 0.5rem;
        padding: 0.5rem;
        border-style: dashed;
    }

    .seat.chair {
        border-radius: 999px;
        padding: 0.25rem;
    }

    .seat:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 
            0 12px 24px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.3),
            inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        border-color: rgba(255, 255, 255, 0.4);
    }

    .seat.selected {
        border: 3px solid #fff;
        box-shadow: 
            0 0 0 4px rgba(255, 107, 53, 0.4),
            0 12px 24px rgba(255, 107, 53, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        transform: scale(1.08);
        z-index: 100;
    }

    .seat-number {
        font-size: 16px;
        font-weight: 800;
        line-height: 1;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 1px;
    }

    .seat-capacity {
        font-size: 9px;
        font-weight: 600;
        opacity: 0.9;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        background: rgba(0, 0, 0, 0.2);
        padding: 1px 4px;
        border-radius: 3px;
        display: flex;
        align-items: center;
        gap: 2px;
    }

    .stage {
        position: absolute;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.9) 100%);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        font-weight: 700;
        cursor: move;
        border: 3px solid rgba(148, 163, 184, 0.2);
        box-shadow: 0 12px 25px rgba(15, 23, 42, 0.35);
        font-size: 18px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        border-radius: 0.75rem;
    }

    .stage.placing {
        opacity: 0.75;
        cursor: crosshair;
    }

    .resize-handle {
        position: absolute;
        width: 12px;
        height: 12px;
        background: hsl(var(--primary));
        border: 2px solid #fff;
        border-radius: 999px;
        box-shadow: 0 2px 6px rgba(15, 23, 42, 0.2);
    }

    .resize-handle.se {
        bottom: -6px;
        right: -6px;
        cursor: se-resize;
    }

    .step-indicator {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .step {
        position: relative;
        border-radius: 1rem;
        padding: 1rem 1.25rem;
        background: hsl(var(--muted));
        color: hsl(var(--muted-foreground));
        border: 1px solid hsl(var(--border));
        transition: all 0.2s ease;
    }

    .step strong {
        display: block;
        font-size: 0.95rem;
        margin-bottom: 0.4rem;
        color: hsl(var(--foreground));
    }

    .step.active {
        background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--accent)) 100%);
        color: hsl(var(--primary-foreground));
        border-color: transparent;
        box-shadow: 0 12px 30px rgba(255, 107, 53, 0.28);
    }

    .step.completed {
        background: rgba(34, 197, 94, 0.12);
        color: rgb(21, 128, 61);
        border-color: rgba(34, 197, 94, 0.3);
        box-shadow: 0 10px 25px rgba(21, 128, 61, 0.18);
    }

    .step::after {
        content: '';
        position: absolute;
        inset-inline-end: 15px;
        inset-block-end: 12px;
        width: 36px;
        height: 36px;
        background: rgba(255, 255, 255, 0.12);
        border-radius: 999px;
        z-index: 0;
    }

    .step.active::after {
        background: rgba(255, 255, 255, 0.2);
    }

    .step.completed::after {
        background: rgba(34, 197, 94, 0.2);
    }

    .step:last-child::after {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div class="space-y-1">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400 dark:text-slate-600">Etkinlik dÃ¼zenleme</p>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white">{{ event.name|safe_text }}</h1>
            <p class="text-sm text-slate-600 dark:text-slate-400">Sahne, alan ve oturma dÃ¼zenini sÃ¼rÃ¼kle-bÄ±rak ile
                oluÅŸtur.</p>
        </div>
        <div class="flex flex-wrap items-center gap-2">
            <a href="{{ url_for('event.index') }}" class="btn-shadcn btn-shadcn-ghost btn-shadcn-sm">
                <i class="fas fa-arrow-left"></i>
                <span>Etkinlik listesi</span>
            </a>
            <a href="{{ url_for('reservation.index') }}" class="btn-shadcn btn-shadcn-outline btn-shadcn-sm">
                <i class="fas fa-ticket-alt"></i>
                <span>Rezervasyonlar</span>
            </a>
        </div>
    </div>

    <div class="card-shadcn">
        <div class="card-shadcn-content">
            <div class="step-indicator">
                <div class="step active" id="step-1-indicator">
                    <strong>1. Alan OluÅŸturma</strong>
                    <span class="text-sm">Izgara ve masa sayÄ±sÄ±nÄ± ayarla</span>
                </div>
                <div class="step" id="step-2-indicator">
                    <strong>2. Sahne YerleÅŸimi</strong>
                    <span class="text-sm">Sahneyi yerleÅŸtir</span>
                </div>
                <div class="step" id="step-3-indicator">
                    <strong>3. Masa YerleÅŸimi</strong>
                    <span class="text-sm">MasalarÄ± ekle (saÄŸ tÄ±k)</span>
                </div>
            </div>
        </div>
    </div>

    <div class="setup-wizard active" id="step-1">
        <div class="card-shadcn">
            <div class="card-shadcn-header pb-4">
                <div class="flex items-center gap-3">
                    <span
                        class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/10 text-blue-500">
                        <i class="fas fa-table"></i>
                    </span>
                    <div>
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-white">AdÄ±m 1: Alan OluÅŸturma</h2>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Masa sayÄ±sÄ±nÄ± ve Ä±zgara ayarlarÄ±nÄ± belirle.</p>
                    </div>
                </div>
            </div>
            <div class="card-shadcn-content space-y-4">
                <div class="grid gap-4 md:grid-cols-3">
                    <label class="space-y-2">
                        <span class="label-shadcn text-sm font-semibold text-slate-700 dark:text-slate-200">Toplam Masa SayÄ±sÄ±</span>
                        <input type="number" id="total-tables" class="input-shadcn" value="20" min="1" max="100">
                    </label>
                    <label class="space-y-2">
                        <span class="label-shadcn text-sm font-semibold text-slate-700 dark:text-slate-200">Izgara AralÄ±ÄŸÄ± (px)</span>
                        <input type="number" id="grid-size" class="input-shadcn" value="50" min="25" max="100">
                    </label>
                    <label class="flex items-center gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-medium text-slate-600 dark:border-slate-800 dark:bg-slate-900/60 dark:text-slate-300">
                        <input class="h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary" type="checkbox" id="show-grid" checked>
                        <span>KÄ±lavuz Ã§izgilerini gÃ¶ster</span>
                    </label>
                </div>

                <button class="btn-shadcn btn-shadcn-default" id="configure-grid-btn">
                    <i class="fas fa-cog"></i>
                    <span>AlanÄ± OluÅŸtur ve Devam Et</span>
                </button>
                
                <p class="rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600 dark:border-slate-800 dark:bg-slate-900/50 dark:text-slate-300">
                    <i class="fas fa-info-circle mr-2"></i>
                    Ã–nce alanÄ± oluÅŸtur, sonra sahneyi yerleÅŸtir, en son masalarÄ± ekle.
                </p>
            </div>
        </div>
    </div>

    <div class="setup-wizard" id="step-2">
        <div class="card-shadcn">
            <div class="card-shadcn-header pb-4">
                <div class="flex items-center gap-3">
                    <span
                        class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-orange-500/10 text-orange-500">
                        <i class="fas fa-theater-masks"></i>
                    </span>
                    <div>
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-white">AdÄ±m 2: Sahne YerleÅŸimi</h2>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Sahne boyutlarÄ±nÄ± belirle ve yerleÅŸtir.</p>
                    </div>
                </div>
            </div>
            <div class="card-shadcn-content space-y-4">
                <div class="grid gap-4 md:grid-cols-2">
                    <label class="space-y-2">
                        <span class="label-shadcn text-sm font-semibold text-slate-700 dark:text-slate-200">Sahne GeniÅŸliÄŸi (px)</span>
                        <input type="number" id="stage-width" class="input-shadcn" value="200" min="100" max="600">
                    </label>
                    <label class="space-y-2">
                        <span class="label-shadcn text-sm font-semibold text-slate-700 dark:text-slate-200">Sahne YÃ¼ksekliÄŸi (px)</span>
                        <input type="number" id="stage-height" class="input-shadcn" value="80" min="50" max="200">
                    </label>
                </div>

                <div class="flex flex-wrap gap-3">
                    <button class="btn-shadcn btn-shadcn-ghost" id="back-to-grid-from-stage-btn">
                        <i class="fas fa-arrow-left"></i>
                        <span>Ã–nceki AdÄ±m</span>
                    </button>
                </div>
                
                <p class="rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600 dark:border-slate-800 dark:bg-slate-900/50 dark:text-slate-300">
                    <i class="fas fa-info-circle mr-2"></i>
                    Sahneyi yerleÅŸtirmek iÃ§in kanvas Ã¼zerinde istediÄŸin noktayÄ± tÄ±kla.
                </p>
            </div>
        </div>
    </div>

    <div class="setup-wizard" id="step-3">
        <div class="card-shadcn">
            <div class="card-shadcn-header pb-4">
                <div class="flex items-center gap-3">
                    <span
                        class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-500/10 text-emerald-500">
                        <i class="fas fa-chair"></i>
                    </span>
                    <div>
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-white">AdÄ±m 3: Masa YerleÅŸimi</h2>
                        <p class="text-sm text-slate-500 dark:text-slate-400">MasalarÄ± seÃ§ ve yerleÅŸtir. SaÄŸ tÄ±k ile hÄ±zlÄ± ekle.</p>
                    </div>
                </div>
            </div>
            <div class="card-shadcn-content space-y-4">
                <!-- Masa SayacÄ± -->
                <div class="rounded-xl border border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100 p-4 dark:border-slate-700 dark:from-slate-900 dark:to-slate-800">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-emerald-500/10 text-emerald-600 dark:text-emerald-400">
                                <i class="fas fa-chair text-xl"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-slate-600 dark:text-slate-400">YerleÅŸtirilen Masa</div>
                                <div class="text-2xl font-bold text-slate-900 dark:text-white">
                                    <span id="placed-seats-count">0</span> / <span id="total-seats-limit">0</span>
                                </div>
                            </div>
                        </div>
                        <div id="seat-limit-warning" class="hidden rounded-lg bg-amber-100 px-3 py-2 text-sm font-medium text-amber-800 dark:bg-amber-900/30 dark:text-amber-200">
                            <i class="fas fa-exclamation-triangle"></i>
                            Limit doldu!
                        </div>
                    </div>
                    <!-- Masa tÃ¼rlerine gÃ¶re daÄŸÄ±lÄ±m -->
                    <div id="seat-distribution" class="mt-3 flex flex-wrap gap-2"></div>
                </div>

                <div class="flex flex-wrap gap-2">
                    <button class="btn-shadcn btn-shadcn-outline" id="delete-selected-btn" disabled>
                        <i class="fas fa-trash"></i>
                        <span>SeÃ§ileni Sil</span>
                    </button>
                    <button class="btn-shadcn btn-shadcn-destructive" id="clear-all-btn">
                        <i class="fas fa-broom"></i>
                        <span>TÃ¼mÃ¼nÃ¼ Temizle</span>
                    </button>
                </div>

                <div class="flex flex-wrap gap-3">
                    <button class="btn-shadcn btn-shadcn-ghost" id="back-to-stage-from-seating-btn"></button>
                        <i class="fas fa-arrow-left"></i>
                        <span>Ã–nceki AdÄ±m</span>
                    </button>
                    <button class="btn-shadcn btn-shadcn-default" id="save-layout-btn">
                        <i class="fas fa-save"></i>
                        <span>YerleÅŸimi Kaydet</span>
                    </button>
                </div>

                <div id="layout-info"
                    class="rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600 dark:border-slate-800 dark:bg-slate-900/50 dark:text-slate-300">
                    <strong class="text-slate-800 dark:text-slate-100">Ä°puÃ§larÄ±</strong>
                    <ul class="mt-2 list-disc space-y-1 pl-5">
                        <li>SaÄŸdaki panelden masa tÃ¼rÃ¼nÃ¼ seÃ§, <strong>"Kanvasa TÄ±klayarak Ekle"</strong> butonuna tÄ±kla.</li>
                        <li>MasalarÄ± <strong>sÃ¼rÃ¼kleyerek</strong> hizalayabilir, grid aÃ§Ä±kken otomatik hizalama kullanabilirsin.</li>
                        <li><strong>Ctrl</strong> basÄ±lÄ± tutarak <strong>birden fazla masa seÃ§</strong>, toplu taÅŸÄ±yabilir veya silebilirsin.</li><li>Masaya <strong>saÄŸ tÄ±k</strong> yaparak hÄ±zlÄ±ca silebilirsin.</li><li>Bir masayÄ± seÃ§mek iÃ§in Ã¼zerine <strong>tÄ±kla</strong>, silmek iÃ§in â€œSeÃ§ileni Silâ€ butonunu kullan.</li>
                        <li>YerleÅŸimi kaydettiÄŸinde etkinlik ana sayfasÄ±na yÃ¶nlendirileceksin.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="card-shadcn">
        <div class="card-shadcn-header pb-4">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Kanvas Ã–nizleme</h2>
            <p class="text-sm text-slate-500 dark:text-slate-400">Sahne ve koltuk yerleÅŸimlerini gerÃ§ek zamanlÄ± olarak
                dÃ¼zenle.</p>
        </div>
        <div class="card-shadcn-content">
            <div class="grid gap-4 lg:grid-cols-[1fr_320px]">
                <!-- Kanvas -->
                <div
                    class="relative overflow-auto rounded-xl border border-dashed border-slate-200 bg-slate-100/60 p-4 dark:border-slate-800 dark:bg-slate-900/30">
                    <div id="seating-canvas" class="grid-enabled"></div>
                    
                    <!-- Floating Onaylama Butonu -->
                    <div id="floating-confirm-btn" style="display:none;" class="absolute top-4 right-4 z-50">
                        <button class="btn-shadcn btn-shadcn-default shadow-lg" id="confirm-stage-floating">
                            <i class="fas fa-check"></i>
                            <span>Sahneyi Onayla</span>
                        </button>
                    </div>
                </div>

                <!-- HÄ±zlÄ± Masa Ekleme Paneli -->
                <div class="space-y-4">
                    <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900">
                        <div class="mb-4 flex items-center gap-2 border-b border-slate-200 pb-3 dark:border-slate-800">
                            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-600 dark:text-emerald-400">
                                <i class="fas fa-plus-circle text-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-900 dark:text-white">HÄ±zlÄ± Masa Ekle</h3>
                                <p class="text-xs text-slate-500 dark:text-slate-400">Kanvasa tÄ±klayarak yerleÅŸtir</p>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <!-- KiÅŸi SayÄ±sÄ± -->
                            <div>
                                <label class="mb-2 flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-300">
                                    <i class="fas fa-users text-slate-400"></i>
                                    KiÅŸi SayÄ±sÄ±
                                </label>
                                <input type="number" id="quick-capacity" 
                                    class="input-shadcn w-full" 
                                    placeholder="KaÃ§ kiÅŸilik?" 
                                    min="1" max="20" value="4">
                            </div>

                            <!-- Tip SeÃ§imi -->
                            <div>
                                <label class="mb-2 flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-300">
                                    <i class="fas fa-shapes text-slate-400"></i>
                                    Tip
                                </label>
                                <select id="quick-type" class="input-shadcn w-full">
                                    <option value="table">ğŸª‘ Masa</option>
                                    <option value="loca">ğŸšª Loca</option>
                                    <option value="chair">ğŸ’º Sandalye</option>
                                </select>
                            </div>

                            <!-- Kategori SeÃ§imi -->
                            <div>
                                <label class="mb-2 flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-300">
                                    <i class="fas fa-star text-slate-400"></i>
                                    Kategori
                                </label>
                                <select id="quick-category" class="input-shadcn w-full">
                                    <option value="vip" data-color="#9333ea">ğŸ‘‘ VIP</option>
                                    <option value="premium" data-color="#f59e0b">ğŸ’ Premium</option>
                                    <option value="deluxe" data-color="#3b82f6">âœ¨ Deluxe</option>
                                    <option value="standart" data-color="#10b981">âœ“ Standart</option>
                                </select>
                            </div>

                            <!-- Ekle Butonu -->
                            <button class="btn-shadcn btn-shadcn-default w-full" id="quick-add-btn">
                                <i class="fas fa-mouse-pointer"></i>
                                <span>Kanvasa TÄ±klayarak Ekle</span>
                            </button>

                            <!-- Bilgi -->
                            <div class="rounded-lg bg-blue-50 p-3 text-xs text-blue-700 dark:bg-blue-950/30 dark:text-blue-300">
                                <i class="fas fa-info-circle mr-1"></i>
                                Butona tÄ±kla, sonra kanvasta istediÄŸin yere tÄ±kla
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Masa Context Menu (SaÄŸ TÄ±k) -->
            <div id="seat-context-menu" class="context-menu">
                <div class="context-menu-items" style="padding: 0.5rem;">
                    <div class="context-menu-item" id="delete-seat-menu-item" style="background: rgb(220, 38, 38); color: white;">
                        <i class="fas fa-trash"></i>
                        <span>MasayÄ± Sil</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/modal-helpers.js"></script>
<script>
    // Global State
    let currentStep = 1;
    let stageElement = null;
    let selectedSeatingType = null;
    let selectedSeat = null;
    let selectedSeats = []; // Ã‡oklu seÃ§im iÃ§in
    let seatCount = 1;
    let canvasWidth = 800;
    let canvasHeight = 600;
    let gridSize = 50;
    let snapToGrid = true;
    let totalSeatsLimit = 0;
    let placedSeatsCount = 0;
    let seatTypeDistribution = {}; // Masa tÃ¼rlerine gÃ¶re daÄŸÄ±lÄ±m

    // Dragging state
    let isDragging = false;
    let isResizing = false;
    let dragOffsetX = 0;
    let dragOffsetY = 0;
    let dragElement = null;

    const canvas = document.getElementById( 'seating-canvas' );

    // Initialize canvas
    function initCanvas( width, height ) {
        canvasWidth = width;
        canvasHeight = height;
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
    }

    // Initial size
    initCanvas( 800, 600 );

    // Step Navigation
    function showStep( step ) {
        document.querySelectorAll( '.setup-wizard' ).forEach( el => el.classList.remove( 'active' ) );
        document.querySelectorAll( '.step' ).forEach( el => {
            el.classList.remove( 'active' );
            el.classList.remove( 'completed' );
        } );

        document.getElementById( `step-${step}` ).classList.add( 'active' );
        document.getElementById( `step-${step}-indicator` ).classList.add( 'active' );

        for ( let i = 1; i < step; i++ ) {
            document.getElementById( `step-${i}-indicator` ).classList.add( 'completed' );
        }

        currentStep = step;

        // Step 2'ye geÃ§ince otomatik sahne yerleÅŸtirme baÅŸlat
        if (step === 2) {
            setTimeout(() => {
                autoPlaceStage();
            }, 300);
        }
    }

    // Snap to grid helper
    function snapToGridPosition( value ) {
        if ( !snapToGrid ) return value;
        return Math.round( value / gridSize ) * gridSize;
    }

    // ==================== STEP 1: Stage Placement ====================

    let isPlacingStage = false;

    // Otomatik sahne yerleÅŸtirme baÅŸlat
    function autoPlaceStage() {
        const width = parseInt( document.getElementById( 'stage-width' ).value );
        const height = parseInt( document.getElementById( 'stage-height' ).value );

        if ( stageElement ) {
            stageElement.remove();
        }

        stageElement = document.createElement( 'div' );
        stageElement.className = 'stage placing';
        stageElement.style.width = width + 'px';
        stageElement.style.height = height + 'px';
        stageElement.innerHTML = '<i class="fas fa-theater-masks me-2"></i>SAHNE';
        stageElement.style.left = '50px';
        stageElement.style.top = '50px';

        canvas.appendChild( stageElement );
        
        // Sahneyi sÃ¼rÃ¼klenebilir ve boyutlandÄ±rÄ±labilir yap
        makeDraggable( stageElement );
        makeResizable( stageElement );
        
        isPlacingStage = true;

        // Floating butonu gÃ¶ster
        document.getElementById( 'floating-confirm-btn' ).style.display = 'block';

        toastInfo( 'Sahneyi yerleÅŸtirmek iÃ§in kanvasta istediÄŸin yere tÄ±kla. SaÄŸ alt kÃ¶ÅŸeden boyutlandÄ±rabilirsin.' );
    }

    // Floating confirm butonu
    document.getElementById( 'confirm-stage-floating' ).addEventListener( 'click', function () {
        if ( !stageElement ) {
            showWarning( 'Ã–nce sahneyi yerleÅŸtir!' );
            return;
        }
        stageElement.classList.remove( 'placing' );
        isPlacingStage = false;
        document.getElementById( 'floating-confirm-btn' ).style.display = 'none';
        toastSuccess('Sahne yerleÅŸtirildi! Åimdi masalarÄ± ekle');
        showStep( 3 ); // Sahne'den Masa'ya
    } );

    // ==================== STEP 2: Grid Configuration ====================

    document.getElementById( 'show-grid' ).addEventListener( 'change', function () {
        if ( this.checked ) {
            canvas.classList.add( 'grid-enabled' );
        } else {
            canvas.classList.remove( 'grid-enabled' );
        }
        snapToGrid = this.checked;
    } );

    document.getElementById( 'grid-size' ).addEventListener( 'change', function () {
        gridSize = parseInt( this.value );
        canvas.style.backgroundSize = `${gridSize}px ${gridSize}px`;
    } );

    document.getElementById( 'configure-grid-btn' ).addEventListener( 'click', function () {
        const totalTables = parseInt( document.getElementById( 'total-tables' ).value );
        gridSize = parseInt( document.getElementById( 'grid-size' ).value );

        // Masa limitini ayarla
        totalSeatsLimit = totalTables;
        document.getElementById('total-seats-limit').textContent = totalSeatsLimit;
        document.getElementById('placed-seats-count').textContent = '0';

        // Calculate optimal canvas size based on table count
        const tablesPerRow = Math.ceil( Math.sqrt( totalTables ) );
        const tableSize = 60;
        const margin = 100;

        canvasWidth = Math.max( 800, ( tablesPerRow * tableSize ) + ( tablesPerRow * gridSize ) + margin );
        canvasHeight = Math.max( 600, canvasWidth * 0.75 );

        initCanvas( canvasWidth, canvasHeight );
        canvas.style.backgroundSize = `${gridSize}px ${gridSize}px`;
        updateSeatCounter();

        // Direkt sahne yerleÅŸtirme adÄ±mÄ±na geÃ§
        toastSuccess('Alan oluÅŸturuldu! Åimdi sahneyi yerleÅŸtir');
        showStep( 2 );
    } );

    // back-to-stage-btn kaldÄ±rÄ±ldÄ± - artÄ±k kullanÄ±lmÄ±yor

    // ==================== STEP 3: Seating Layout ====================

    // HÄ±zlÄ± Masa Ekleme Paneli
    let isQuickAddMode = false;
    let quickAddConfig = null;

    function initQuickAddPanel() {
        const quickAddBtn = document.getElementById('quick-add-btn');
        const quickCapacity = document.getElementById('quick-capacity');
        const quickType = document.getElementById('quick-type');
        const quickCategory = document.getElementById('quick-category');
        
        if (!quickAddBtn) {
            console.error('âŒ Quick add panel bulunamadÄ±!');
            return;
        }
        
        // HÄ±zlÄ± ekleme modunu aktifleÅŸtir
        quickAddBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Event bubbling'i durdur
            
            // EÄŸer zaten aktifse, iptal et
            if (isQuickAddMode) {
                cancelQuickAddMode();
                return;
            }
            
            const capacity = parseInt(quickCapacity.value);
            const type = quickType.value;
            const category = quickCategory.value;
            
            if (!capacity || capacity < 1) {
                showWarning('LÃ¼tfen geÃ§erli bir kiÅŸi sayÄ±sÄ± girin');
                return;
            }
            
            // Renk belirleme
            const colors = {
                vip: '#9333ea',
                premium: '#f59e0b',
                deluxe: '#3b82f6',
                standart: '#10b981'
            };
            
            // Ä°sim oluÅŸtur
            const typeNames = {
                table: 'Masa',
                loca: 'Loca',
                chair: 'Sandalye'
            };
            
            const seatName = `${category.toUpperCase()} ${typeNames[type]}`;
            
            quickAddConfig = {
                id: Date.now(),
                name: seatName,
                seatType: type,
                capacity: capacity,
                color: colors[category]
            };
            
            isQuickAddMode = true;
            canvas.style.cursor = 'crosshair';
            quickAddBtn.innerHTML = '<i class="fas fa-times"></i><span>Ä°ptal</span>';
            quickAddBtn.classList.remove('btn-shadcn-default');
            quickAddBtn.classList.add('btn-shadcn-destructive');
            
            toastInfo('Kanvasta istediÄŸin yere tÄ±kla');
        });
        
        // Enter ile aktifleÅŸtir
        quickCapacity.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                quickAddBtn.click();
            }
        });
    }

    // HÄ±zlÄ± ekleme modunu iptal et
    function cancelQuickAddMode() {
        isQuickAddMode = false;
        quickAddConfig = null;
        canvas.style.cursor = 'default';
        
        const quickAddBtn = document.getElementById('quick-add-btn');
        quickAddBtn.innerHTML = '<i class="fas fa-mouse-pointer"></i><span>Kanvasa TÄ±klayarak Ekle</span>';
        quickAddBtn.classList.remove('btn-shadcn-destructive');
        quickAddBtn.classList.add('btn-shadcn-default');
    }

    // Canvas'a tÄ±klama - TEK EVENT HANDLER
    canvas.addEventListener('click', function(e) {
        const rect = this.getBoundingClientRect();
        let x = e.clientX - rect.left;
        let y = e.clientY - rect.top;

        // Sahne yerleÅŸtirme modu
        if ( isPlacingStage && stageElement ) {
            x = snapToGridPosition( x - parseInt( stageElement.style.width ) / 2 );
            y = snapToGridPosition( y - parseInt( stageElement.style.height ) / 2 );

            stageElement.style.left = x + 'px';
            stageElement.style.top = y + 'px';

            isPlacingStage = false;
            stageElement.classList.remove( 'placing' );
            return;
        }

        // Quick Add Mode - Masa ekleme
        if (currentStep === 3 && isQuickAddMode) {
            // Sahneye veya mevcut masaya tÄ±klanmÄ±ÅŸsa iptal et
            if (e.target.classList.contains('stage') || e.target.classList.contains('seat') || e.target !== canvas) {
                return;
            }
            
            x = snapToGridPosition(x);
            y = snapToGridPosition(y);
            
            // Masa ekle
            selectedSeatingType = quickAddConfig;
            createSeat(x, y);
            
            toastSuccess(`${quickAddConfig.name} (${quickAddConfig.capacity} kiÅŸi) eklendi`);
            
            // Modu iptal et
            cancelQuickAddMode();
            return;
        }
    });

    // ==================== Seat Context Menu ====================
    
    const seatContextMenu = document.getElementById('seat-context-menu');
    const deleteSeatMenuItem = document.getElementById('delete-seat-menu-item');
    
    function showSeatContextMenu(x, y) {
        seatContextMenu.style.left = x + 'px';
        seatContextMenu.style.top = y + 'px';
        seatContextMenu.classList.add('show');
    }
    
    function hideSeatContextMenu() {
        seatContextMenu.classList.remove('show');
    }
    
    // Masa silme
    deleteSeatMenuItem.addEventListener('click', () => {
        if (selectedSeats.length > 0) {
            const count = selectedSeats.length;
            
            // TÃ¼m seÃ§ili masalarÄ± sil
            selectedSeats.forEach( seat => seat.remove() );
            
            // SeÃ§imleri temizle
            selectedSeats = [];
            selectedSeat = null;
            document.getElementById('delete-selected-btn').disabled = true;
            
            updateSeatCounter();
            toastSuccess( count > 1 ? `${count} masa silindi` : 'Masa silindi' );
        }
        hideSeatContextMenu();
    });
    
    // Herhangi bir yere tÄ±klandÄ±ÄŸÄ±nda context menu'yÃ¼ kapat
    document.addEventListener('click', hideSeatContextMenu);
    
    // Quick panel'i baÅŸlat
    window.addEventListener('load', () => {
        console.log('ğŸš€ Page loaded, initializing quick add panel...');
        setTimeout(() => {
            initQuickAddPanel();
        }, 500);
    });

    document.querySelectorAll( '.seating-type-btn' ).forEach( btn => {
        btn.addEventListener( 'click', function () {
            document.querySelectorAll( '.seating-type-btn' ).forEach( b => {
                b.style.border = '2px solid rgba(0,0,0,0.2)';
            } );
            this.style.border = '3px solid #ffc107';

            selectedSeatingType = {
                id: this.dataset.typeId,
                name: this.dataset.typeName,
                seatType: this.dataset.seatType,
                capacity: this.dataset.capacity,
                color: this.dataset.color
            };
        } );
    } );

    // Sahne'den Alan'a geri dÃ¶n
    document.getElementById( 'back-to-grid-from-stage-btn' ).addEventListener( 'click', function () {
        showStep( 1 );
    } );

    // Masa'dan Sahne'ye geri dÃ¶n
    document.getElementById( 'back-to-stage-from-seating-btn' ).addEventListener( 'click', function () {
        showStep( 2 );
    } );

    document.getElementById( 'delete-selected-btn' ).addEventListener( 'click', function () {
        if ( selectedSeats.length > 0 ) {
            const count = selectedSeats.length;
            
            // TÃ¼m seÃ§ili masalarÄ± sil
            selectedSeats.forEach( seat => seat.remove() );
            
            // SeÃ§imleri temizle
            selectedSeats = [];
            selectedSeat = null;
            this.disabled = true;
            
            updateSeatCounter();
            toastSuccess( count > 1 ? `${count} masa silindi` : 'Masa silindi' );
        }
    } );

    document.getElementById( 'clear-all-btn' ).addEventListener( 'click', async function () {
        const confirmed = await confirmClearAll();
        if ( confirmed ) {
            document.querySelectorAll( '.seat' ).forEach( seat => seat.remove() );
            seatCount = 1;
            selectedSeat = null;
            selectedSeats = [];
            document.getElementById( 'delete-selected-btn' ).disabled = true;
            updateSeatCounter(); // SayacÄ± gÃ¼ncelle
            toastSuccess('TÃ¼m koltuklar temizlendi');
        }
    } );

    document.getElementById( 'save-layout-btn' ).addEventListener( 'click', function () {
        const seats = [];
        document.querySelectorAll( '.seat' ).forEach( seat => {
            seats.push( {
                seating_type_id: seat.dataset.typeId,
                seat_number: seat.textContent,
                position_x: parseInt( seat.style.left ),
                position_y: parseInt( seat.style.top ),
                width: parseInt( seat.style.width ) || 60,
                height: parseInt( seat.style.height ) || 40,
                color_code: seat.style.backgroundColor || seat.dataset.color
            } );
        } );

        const stageData = stageElement ? {
            width: parseInt( stageElement.style.width ),
            height: parseInt( stageElement.style.height ),
            position_x: parseInt( stageElement.style.left ),
            position_y: parseInt( stageElement.style.top )
        } : null;

        const layoutData = {
            seats: seats,
            stage: stageData,
            stage_position: 'top',
            canvas_width: canvasWidth,
            canvas_height: canvasHeight,
            grid_size: gridSize
        };

        console.log( 'ğŸ“¤ GÃ¶nderilen veri:', layoutData );

        fetch( "{{ url_for('event.save_layout', event_id=event.id) }}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify( layoutData )
        } )
            .then( response => response.json() )
            .then( data => {
                console.log( 'ğŸ“¥ Sunucu yanÄ±tÄ±:', data );
                if ( data.success ) {
                    alert( 'YerleÅŸim planÄ± baÅŸarÄ±yla kaydedildi!' );
                    window.location.href = "{{ url_for('event.index') }}";
                } else {
                    alert( 'Hata: ' + ( data.message || 'Bilinmeyen hata' ) );
                }
            } )
            .catch( error => {
                console.error( 'âŒ KayÄ±t hatasÄ±:', error );
                alert( 'KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu: ' + error.message );
            } );
    } );

    // ==================== Canvas Interactions ====================
    // Canvas click event yukarÄ±da tanÄ±mlandÄ± (Quick Add Mode ile birleÅŸtirildi)

    // YardÄ±mcÄ± fonksiyonlar - createSeat'ten Ã¶nce tanÄ±mlanmalÄ±
    
    // Renk koyulaÅŸtÄ±rma/aÃ§ma fonksiyonu
    function adjustColor(color, amount) {
        const clamp = (num) => Math.min(Math.max(num, 0), 255);
        
        // Hex to RGB
        const hex = color.replace('#', '');
        const r = parseInt(hex.substr(0, 2), 16);
        const g = parseInt(hex.substr(2, 2), 16);
        const b = parseInt(hex.substr(4, 2), 16);
        
        // Adjust
        const newR = clamp(r + amount);
        const newG = clamp(g + amount);
        const newB = clamp(b + amount);
        
        // RGB to Hex
        return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;
    }
    
    function canAddMoreSeats() {
        if (totalSeatsLimit === 0) return true; // Limit belirlenmemiÅŸse serbest
        return placedSeatsCount < totalSeatsLimit;
    }

    function updateSeatCounter() {
        placedSeatsCount = document.querySelectorAll('.seat').length;
        document.getElementById('placed-seats-count').textContent = placedSeatsCount;
        
        // Limit uyarÄ±sÄ±
        const warning = document.getElementById('seat-limit-warning');
        if (placedSeatsCount >= totalSeatsLimit && totalSeatsLimit > 0) {
            warning.classList.remove('hidden');
        } else {
            warning.classList.add('hidden');
        }
        
        // Masa tÃ¼rlerine gÃ¶re daÄŸÄ±lÄ±mÄ± gÃ¼ncelle
        updateSeatDistribution();
    }
    
    function updateSeatDistribution() {
        seatTypeDistribution = {};
        document.querySelectorAll('.seat').forEach(seat => {
            const typeName = seat.dataset.typeName || 'Bilinmeyen';
            const color = seat.dataset.color || '#6b7280';
            seatTypeDistribution[typeName] = seatTypeDistribution[typeName] || { count: 0, color: color };
            seatTypeDistribution[typeName].count++;
        });
        
        // DaÄŸÄ±lÄ±mÄ± gÃ¶ster
        const distributionEl = document.getElementById('seat-distribution');
        distributionEl.innerHTML = '';
        
        for (const [typeName, data] of Object.entries(seatTypeDistribution)) {
            const badge = document.createElement('div');
            badge.className = 'inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm font-medium text-white';
            badge.style.backgroundColor = data.color;
            badge.innerHTML = `
                <i class="fas fa-chair"></i>
                <span>${typeName}: ${data.count}</span>
            `;
            distributionEl.appendChild(badge);
        }
    }

    function createSeat( x, y ) {
        // Limit kontrolÃ¼
        if (!canAddMoreSeats()) {
            showWarning(`Maksimum ${totalSeatsLimit} masa yerleÅŸtirebilirsiniz!`, 'Limit Doldu');
            return;
        }

        const seat = document.createElement( 'div' );
        seat.className = 'seat ' + selectedSeatingType.seatType;

        // TÃ¼m masalar tek grid karesi boyutunda (50x50px)
        const size = 50;
        seat.style.width = size + 'px';
        seat.style.height = size + 'px';

        x = snapToGridPosition( x - size / 2 );
        y = snapToGridPosition( y - size / 2 );

        seat.style.left = x + 'px';
        seat.style.top = y + 'px';
        
        // Renk ve gradient efekti
        const baseColor = selectedSeatingType.color;
        seat.style.background = `linear-gradient(135deg, ${baseColor} 0%, ${adjustColor(baseColor, -20)} 100%)`;
        
        seat.dataset.typeId = selectedSeatingType.id;
        seat.dataset.typeName = selectedSeatingType.name;
        seat.dataset.color = selectedSeatingType.color;
        
        // Masa numarasÄ± ve kapasite gÃ¶sterimi - GÃ¼zel tasarÄ±m
        const icon = selectedSeatingType.seatType === 'table' ? 'ğŸª‘' : 
                     selectedSeatingType.seatType === 'loca' ? 'ğŸšª' : 'ğŸ’º';
        
        // Masa tÃ¼rÃ¼ isminden kategoriyi Ã§Ä±kar (VIP, PREMIUM, vb.)
        const category = selectedSeatingType.name.split(' ')[0];
        
        seat.innerHTML = `
            <div class="seat-number">${icon} ${seatCount}</div>
            <div class="seat-capacity">
                <i class="fas fa-users" style="font-size: 7px;"></i>
                ${selectedSeatingType.capacity}
            </div>
            <div style="font-size: 7px; font-weight: 800; opacity: 0.7; margin-top: 1px; letter-spacing: 0.3px;">${category}</div>
        `;
        seatCount++;

        canvas.appendChild( seat );
        makeDraggable( seat );
        
        // SayacÄ± gÃ¼ncelle
        updateSeatCounter();

        seat.addEventListener( 'click', function ( e ) {
            e.stopPropagation();
            
            // Ctrl ile Ã§oklu seÃ§im
            if ( e.ctrlKey || e.metaKey ) {
                // Zaten seÃ§iliyse, seÃ§imi kaldÄ±r
                if ( this.classList.contains( 'selected' ) ) {
                    this.classList.remove( 'selected' );
                    selectedSeats = selectedSeats.filter( s => s !== this );
                } else {
                    // SeÃ§ime ekle
                    this.classList.add( 'selected' );
                    selectedSeats.push( this );
                }
                
                // Tek seÃ§im deÄŸiÅŸkenini gÃ¼ncelle
                selectedSeat = selectedSeats.length > 0 ? selectedSeats[0] : null;
            } else {
                // Normal seÃ§im - tÃ¼m seÃ§imleri temizle
                selectedSeats.forEach( s => s.classList.remove( 'selected' ) );
                selectedSeats = [];
                
                this.classList.add( 'selected' );
                selectedSeat = this;
                selectedSeats = [this];
            }
            
            // Sil butonunu gÃ¼ncelle
            document.getElementById( 'delete-selected-btn' ).disabled = selectedSeats.length === 0;
            
            // SeÃ§im sayÄ±sÄ±nÄ± gÃ¶ster
            if ( selectedSeats.length > 1 ) {
                toastInfo( `${selectedSeats.length} masa seÃ§ildi. Toplu taÅŸÄ±yabilirsin.` );
            }
        } );
        
        // SaÄŸ tÄ±k context menu
        seat.addEventListener( 'contextmenu', function ( e ) {
            e.preventDefault();
            e.stopPropagation();
            
            // EÄŸer bu masa zaten seÃ§ili deÄŸilse, sadece bunu seÃ§
            if ( !this.classList.contains( 'selected' ) ) {
                selectedSeats.forEach( s => s.classList.remove( 'selected' ) );
                selectedSeats = [];
                
                this.classList.add( 'selected' );
                selectedSeat = this;
                selectedSeats = [this];
            }
            
            // Context menu'yÃ¼ gÃ¶ster
            showSeatContextMenu(e.clientX, e.clientY);
        } );
    }

    function makeDraggable( element ) {
        element.addEventListener( 'mousedown', function ( e ) {
            if ( e.target.classList.contains( 'resize-handle' ) ) return;

            isDragging = true;
            dragElement = this;
            const rect = this.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;

            this.style.cursor = 'grabbing';
            
            // EÄŸer bu masa seÃ§ili masalardan biriyse, tÃ¼m seÃ§ili masalarÄ±n baÅŸlangÄ±Ã§ pozisyonlarÄ±nÄ± kaydet
            if ( selectedSeats.includes( this ) && selectedSeats.length > 1 ) {
                selectedSeats.forEach( seat => {
                    seat.dataset.startX = parseInt( seat.style.left );
                    seat.dataset.startY = parseInt( seat.style.top );
                } );
            }
        } );
    }

    function makeResizable( element ) {
        const handle = document.createElement( 'div' );
        handle.className = 'resize-handle se';
        element.appendChild( handle );

        handle.addEventListener( 'mousedown', function ( e ) {
            e.stopPropagation();
            isResizing = true;
            dragElement = element;
        } );
    }

    document.addEventListener( 'mousemove', function ( e ) {
        if ( isDragging && dragElement ) {
            const canvasRect = canvas.getBoundingClientRect();
            let x = e.clientX - canvasRect.left - dragOffsetX;
            let y = e.clientY - canvasRect.top - dragOffsetY;

            x = snapToGridPosition( x );
            y = snapToGridPosition( y );

            x = Math.max( 0, Math.min( x, canvasWidth - dragElement.offsetWidth ) );
            y = Math.max( 0, Math.min( y, canvasHeight - dragElement.offsetHeight ) );

            // EÄŸer Ã§oklu seÃ§im varsa, tÃ¼m seÃ§ili masalarÄ± birlikte taÅŸÄ±
            if ( selectedSeats.includes( dragElement ) && selectedSeats.length > 1 ) {
                const deltaX = x - parseInt( dragElement.dataset.startX );
                const deltaY = y - parseInt( dragElement.dataset.startY );
                
                selectedSeats.forEach( seat => {
                    let newX = parseInt( seat.dataset.startX ) + deltaX;
                    let newY = parseInt( seat.dataset.startY ) + deltaY;
                    
                    newX = Math.max( 0, Math.min( newX, canvasWidth - seat.offsetWidth ) );
                    newY = Math.max( 0, Math.min( newY, canvasHeight - seat.offsetHeight ) );
                    
                    seat.style.left = newX + 'px';
                    seat.style.top = newY + 'px';
                } );
            } else {
                // Tek masa taÅŸÄ±ma
                dragElement.style.left = x + 'px';
                dragElement.style.top = y + 'px';
            }
        }

        if ( isResizing && dragElement ) {
            const canvasRect = canvas.getBoundingClientRect();
            let newWidth = snapToGridPosition( e.clientX - canvasRect.left - parseInt( dragElement.style.left ) );
            let newHeight = snapToGridPosition( e.clientY - canvasRect.top - parseInt( dragElement.style.top ) );

            newWidth = Math.max( 100, Math.min( newWidth, canvasWidth - parseInt( dragElement.style.left ) ) );
            newHeight = Math.max( 50, Math.min( newHeight, canvasHeight - parseInt( dragElement.style.top ) ) );

            dragElement.style.width = newWidth + 'px';
            dragElement.style.height = newHeight + 'px';
        }
    } );

    document.addEventListener( 'mouseup', function () {
        if ( dragElement ) {
            dragElement.style.cursor = 'move';
        }
        isDragging = false;
        isResizing = false;
        dragElement = null;
    } );
</script>
{% endblock %}

    // 
==================== Masa SayacÄ± ve Limit KontrolÃ¼ ====================
    
    function updateSeatCounter() {
        placedSeatsCount = document.querySelectorAll('.seat').length;
        document.getElementById('placed-seats-count').textContent = placedSeatsCount;
        
        // Limit uyarÄ±sÄ±
        const warning = document.getElementById('seat-limit-warning');
        if (placedSeatsCount >= totalSeatsLimit) {
            warning.classList.remove('hidden');
        } else {
            warning.classList.add('hidden');
        }
        
        // Masa tÃ¼rlerine gÃ¶re daÄŸÄ±lÄ±mÄ± gÃ¼ncelle
        updateSeatDistribution();
    }
    
    function updateSeatDistribution() {
        seatTypeDistribution = {};
        document.querySelectorAll('.seat').forEach(seat => {
            const typeName = seat.dataset.typeName || 'Bilinmeyen';
            const color = seat.dataset.color || '#6b7280';
            seatTypeDistribution[typeName] = seatTypeDistribution[typeName] || { count: 0, color: color };
            seatTypeDistribution[typeName].count++;
        });
        
        // DaÄŸÄ±lÄ±mÄ± gÃ¶ster
        const distributionEl = document.getElementById('seat-distribution');
        distributionEl.innerHTML = '';
        
        for (const [typeName, data] of Object.entries(seatTypeDistribution)) {
            const badge = document.createElement('div');
            badge.className = 'inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm font-medium text-white';
            badge.style.backgroundColor = data.color;
            badge.innerHTML = `
                <i class="fas fa-chair"></i>
                <span>${typeName}: ${data.count}</span>
            `;
            distributionEl.appendChild(badge);
        }
    }
    
    function canAddMoreSeats() {
        if (totalSeatsLimit === 0) return true; // Limit belirlenmemiÅŸse serbest
        return placedSeatsCount < totalSeatsLimit;
    }
    
    // AdÄ±m 1'de total seats limit'i ayarla (configure-grid-btn ile)
    // Zaten configure-grid-btn event listener'Ä±nda ayarlanÄ±yor
